<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=yes">
  <title>Get Explanation</title>
  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      background: #0A0C0F;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 0;  /* Remove padding for full screen */
    }

    /* Main Container - Full Screen */
    .app {
      width: 100%;
      height: 100vh;  /* Full viewport height */
      max-width: none;  /* Remove max-width */
      background: #111417;
      border: none;  /* Remove border */
      border-radius: 0;  /* Remove border radius */
      overflow: hidden;
      box-shadow: none;  /* Remove shadow */
      display: flex;
      flex-direction: column;
    }

    /* Header - Minimal */
    .header {
      padding: 16px 24px;
      background: #0C0F13;
      border-bottom: 1px solid #1F2329;
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-shrink: 0;
    }

    .logo h1 {
      font-size: 1.4rem;
      font-weight: 700;
      color: #FFFFFF;
      letter-spacing: -0.3px;
    }

    .support-toggle {
      background: #1A1E24;
      border: 1px solid #2A2F38;
      border-radius: 40px;
      padding: 8px 16px;
      display: flex;
      align-items: center;
      gap: 8px;
      cursor: pointer;
      transition: all 0.2s ease;
      color: #94A3B8;
    }

    .support-toggle:hover {
      border-color: #3B82F6;
      color: #FFFFFF;
      background: #1E293B;
    }

    .support-toggle i {
      font-size: 0.9rem;
      color: #3B82F6;
    }

    .support-toggle span {
      font-size: 0.85rem;
      font-weight: 500;
    }

    /* URL Input */
    .url-area {
      padding: 16px 24px;
      background: #111417;
      flex-shrink: 0;
    }

    .input-group {
      display: flex;
      gap: 10px;
      background: #1A1E24;
      border-radius: 40px;
      padding: 4px;
      border: 1px solid #2A2F38;
      transition: 0.2s;
    }

    .input-group:focus-within {
      border-color: #3B82F6;
      box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.2);
    }

    .input-group input {
      flex: 1;
      background: transparent;
      border: none;
      padding: 14px 20px;
      color: #FFFFFF;
      font-size: 0.95rem;
      outline: none;
    }

    .input-group input::placeholder {
      color: #4A5568;
    }

    .input-group button {
      background: #2563EB;
      border: none;
      color: white;
      font-weight: 600;
      padding: 10px 24px;
      border-radius: 36px;
      margin: 4px;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 0.9rem;
      transition: 0.15s;
    }

    .input-group button:hover {
      background: #1D4ED8;
    }

    .input-group button:active {
      transform: scale(0.96);
    }

    /* Status */
    .status-row {
      padding: 4px 24px 12px;
      display: flex;
      align-items: center;
      gap: 10px;
      flex-shrink: 0;
    }

    .status-dot {
      width: 8px;
      height: 8px;
      border-radius: 8px;
      background: #3B82F6;
      transition: 0.2s;
    }

    .status-dot.active {
      background: #10B981;
      box-shadow: 0 0 12px #10B981;
    }

    .status-text {
      color: #64748B;
      font-size: 0.9rem;
      font-weight: 500;
    }

    /* Progress Indicator */
    .progress-container {
      padding: 0 24px 12px;
      flex-shrink: 0;
    }

    .progress-bar {
      height: 4px;
      background: #1E293B;
      border-radius: 4px;
      overflow: hidden;
    }

    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, #2563EB, #7C3AED);
      width: 0%;
      transition: width 0.3s ease;
    }

    .progress-steps {
      display: flex;
      justify-content: space-between;
      margin-top: 8px;
      color: #334155;
      font-size: 0.7rem;
    }

    .step.active {
      color: #3B82F6;
    }

    .step.completed {
      color: #10B981;
    }

    /* Chat Area - Flexible Height */
    .chat-window {
      flex: 1;
      overflow-y: auto;
      padding: 16px 24px;
      background: #0F1217;
      scrollbar-width: thin;
      scrollbar-color: #2D3748 #1A1E24;
      -webkit-overflow-scrolling: touch;
    }

    .chat-window::-webkit-scrollbar {
      width: 4px;
    }

    .chat-window::-webkit-scrollbar-track {
      background: #1A1E24;
    }

    .chat-window::-webkit-scrollbar-thumb {
      background: #2D3748;
      border-radius: 20px;
    }

    .chat-window::-webkit-scrollbar-thumb:hover {
      background: #3B82F6;
    }

    .message {
      margin-bottom: 20px;
      max-width: 85%;
      animation: fadeIn 0.2s ease;
    }

    .message.user {
      margin-left: auto;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(8px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .bubble {
      padding: 14px 20px;
      border-radius: 20px;
      font-size: 0.95rem;
      line-height: 1.6;
      word-break: break-word;
    }

    .assistant .bubble {
      background: #1A1E24;
      color: #E2E8F0;
      border-bottom-left-radius: 6px;
      border: 1px solid #2A2F38;
    }

    .user .bubble {
      background: #2563EB;
      color: white;
      border-bottom-right-radius: 6px;
    }

    .time {
      font-size: 0.65rem;
      color: #5A6A7F;
      margin-top: 6px;
      margin-left: 12px;
    }

    /* Question Input */
    .question-area {
      padding: 16px 24px 20px;
      background: #0F1217;
      border-top: 1px solid #20242A;
      flex-shrink: 0;
    }

    .question-group {
      display: flex;
      gap: 10px;
      background: #1A1E24;
      border-radius: 40px;
      padding: 4px;
      border: 1px solid #2A2F38;
    }

    .question-group input {
      flex: 1;
      background: transparent;
      border: none;
      padding: 14px 20px;
      color: white;
      font-size: 0.95rem;
      outline: none;
    }

    .question-group input::placeholder {
      color: #4A5568;
    }

    .question-group input:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .question-group button {
      background: #2563EB;
      border: none;
      width: 50px;
      height: 50px;
      border-radius: 25px;
      margin: 4px;
      color: white;
      font-size: 1.2rem;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: 0.15s;
    }

    .question-group button:hover:not(:disabled) {
      background: #1D4ED8;
    }

    .question-group button:active:not(:disabled) {
      transform: scale(0.94);
    }

    .question-group button:disabled {
      opacity: 0.3;
      cursor: not-allowed;
    }

    /* Support Modal */
    .support-modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      backdrop-filter: blur(8px);
      z-index: 1000;
      align-items: center;
      justify-content: center;
      padding: 16px;
    }

    .support-modal.active {
      display: flex;
    }

    .support-card {
      background: #111417;
      border: 1px solid #2A2F38;
      border-radius: 32px;
      padding: 32px;
      max-width: 400px;
      width: 100%;
      position: relative;
    }

    .close-btn {
      position: absolute;
      top: 20px;
      right: 20px;
      background: #1A1E24;
      border: 1px solid #2A2F38;
      width: 36px;
      height: 36px;
      border-radius: 18px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #94A3B8;
      cursor: pointer;
      transition: 0.2s;
    }

    .close-btn:hover {
      border-color: #3B82F6;
      color: #FFFFFF;
    }

    .support-title {
      color: #FFFFFF;
      font-size: 1.5rem;
      font-weight: 700;
      margin-bottom: 24px;
    }

    .support-links {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    .support-link {
      display: flex;
      align-items: center;
      gap: 16px;
      padding: 16px;
      background: #1A1E24;
      border: 1px solid #2A2F38;
      border-radius: 24px;
      text-decoration: none;
      transition: 0.2s;
    }

    .support-link:hover {
      border-color: #3B82F6;
      transform: translateY(-2px);
    }

    .link-icon {
      width: 48px;
      height: 48px;
      background: #1E293B;
      border-radius: 16px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.8rem;
    }

    .link-icon.instagram {
      color: #E4405F;
    }

    .link-icon.telegram {
      color: #26A5E4;
    }

    .link-info {
      flex: 1;
    }

    .link-platform {
      color: #94A3B8;
      font-size: 0.8rem;
      margin-bottom: 4px;
    }

    .link-handle {
      color: #FFFFFF;
      font-weight: 600;
      font-size: 1.1rem;
    }

    .support-note {
      margin-top: 24px;
      color: #4A5568;
      font-size: 0.8rem;
      text-align: center;
    }

    /* Responsive */
    @media (max-width: 500px) {
      .header {
        padding: 12px 16px;
      }
      .logo h1 {
        font-size: 1.2rem;
      }
      .url-area {
        padding: 12px 16px;
      }
      .input-group {
        flex-wrap: wrap;
      }
      .input-group button {
        width: 100%;
        justify-content: center;
      }
      .status-row {
        padding: 4px 16px 8px;
      }
      .progress-container {
        padding: 0 16px 8px;
      }
      .chat-window {
        padding: 12px 16px;
      }
      .question-area {
        padding: 12px 16px 16px;
      }
    }
  </style>
</head>
<body>
  <div class="app">
    <!-- Header -->
    <div class="header">
      <div class="logo">
        <h1>Get Explanation</h1>
      </div>
      <div class="support-toggle" id="supportToggle">
        <i class="fa-regular fa-headset"></i>
        <span>support</span>
      </div>
    </div>

    <!-- URL Input -->
    <div class="url-area">
      <div class="input-group">
        <input type="text" id="urlField" placeholder="paste youtube link..." value="https://youtu.be/hlQh29qCZ9U">
        <button id="loadBtn">
          <i class="fa-regular fa-cloud-arrow-down"></i>
          <span>Load</span>
        </button>
      </div>
    </div>

    <!-- Status -->
    <div class="status-row" id="statusBar">
      <div class="status-dot" id="statusLed"></div>
      <span class="status-text" id="statusMsg">ready</span>
    </div>

    <!-- Progress (hidden by default) -->
    <div id="progressContainer" class="progress-container" style="display: none;">
      <div class="progress-bar">
        <div class="progress-fill" id="progressFill"></div>
      </div>
      <div class="progress-steps" id="progressSteps">
        <span class="step" id="step1">analyzing</span>
        <span class="step" id="step2">processing</span>
        <span class="step" id="step3">generating</span>
      </div>
    </div>

    <!-- Chat Window -->
    <div class="chat-window" id="chatWindow">
      <div id="messages">
        <div class="message assistant">
          <div class="bubble">üëã paste a link and ask anything</div>
          <div class="time">now</div>
        </div>
      </div>
    </div>

    <!-- Question Input -->
    <div class="question-area">
      <div class="question-group">
        <input type="text" id="questionField" placeholder="ask about video..." disabled>
        <button id="askBtn" disabled>
          <i class="fa-regular fa-paper-plane"></i>
        </button>
      </div>
    </div>
  </div>

  <!-- Support Modal -->
  <div class="support-modal" id="supportModal">
    <div class="support-card">
      <div class="close-btn" id="closeSupport">
        <i class="fa-regular fa-xmark"></i>
      </div>
      
      <div class="support-title">connect with us</div>
      
      <div class="support-links">
        <a href="https://instagram.com/allenchaiwala" target="_blank" class="support-link">
          <div class="link-icon instagram">
            <i class="fa-brands fa-instagram"></i>
          </div>
          <div class="link-info">
            <div class="link-platform">instagram</div>
            <div class="link-handle">@allenchaiwala</div>
          </div>
          <i class="fa-regular fa-arrow-up-right-from-square" style="color: #3B82F6;"></i>
        </a>

        <a href="https://t.me/proplayerhuladle" target="_blank" class="support-link">
          <div class="link-icon telegram">
            <i class="fa-brands fa-telegram"></i>
          </div>
          <div class="link-info">
            <div class="link-platform">telegram</div>
            <div class="link-handle">@proplayerhuladle</div>
          </div>
          <i class="fa-regular fa-arrow-up-right-from-square" style="color: #3B82F6;"></i>
        </a>
      </div>

      <div class="support-note">
        <i class="fa-regular fa-clock" style="margin-right: 6px;"></i>
        quick replies ¬∑ dm for help
      </div>
    </div>
  </div>

  <script>
    (function() {
      // ---------- CONFIG ----------
      const API_KEY = "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";
      const MODEL = "anthropic/claude-3-haiku";  // Working model
      
      // DOM Elements
      const urlField = document.getElementById('urlField');
      const loadBtn = document.getElementById('loadBtn');
      const questionField = document.getElementById('questionField');
      const askBtn = document.getElementById('askBtn');
      const messages = document.getElementById('messages');
      const chatWindow = document.getElementById('chatWindow');
      const statusLed = document.getElementById('statusLed');
      const statusMsg = document.getElementById('statusMsg');
      const progressContainer = document.getElementById('progressContainer');
      const progressFill = document.getElementById('progressFill');
      const step1 = document.getElementById('step1');
      const step2 = document.getElementById('step2');
      const step3 = document.getElementById('step3');

      // Support Modal
      const supportToggle = document.getElementById('supportToggle');
      const supportModal = document.getElementById('supportModal');
      const closeSupport = document.getElementById('closeSupport');

      // State
      let videoContext = '';
      let isLoading = false;
      let isAsking = false;

      // Support Modal Handlers
      supportToggle.addEventListener('click', () => {
        supportModal.classList.add('active');
      });

      closeSupport.addEventListener('click', () => {
        supportModal.classList.remove('active');
      });

      supportModal.addEventListener('click', (e) => {
        if (e.target === supportModal) {
          supportModal.classList.remove('active');
        }
      });

      // Helper Functions
      function scrollToEnd() {
        chatWindow.scrollTop = chatWindow.scrollHeight;
      }

      function setStatus(text, isActive) {
        statusMsg.innerText = text;
        if (isActive) {
          statusLed.classList.add('active');
        } else {
          statusLed.classList.remove('active');
        }
      }

      function startProgress() {
        progressContainer.style.display = 'block';
        let progress = 0;
        
        step1.classList.remove('active', 'completed');
        step2.classList.remove('active', 'completed');
        step3.classList.remove('active', 'completed');
        
        const interval = setInterval(() => {
          if (!isAsking && !isLoading) {
            clearInterval(interval);
            progressContainer.style.display = 'none';
            return;
          }
          
          progress += 1.5;
          if (progress > 100) progress = 100;
          
          progressFill.style.width = progress + '%';
          
          if (progress >= 33) {
            step1.classList.add('completed');
            step2.classList.add('active');
          }
          if (progress >= 66) {
            step2.classList.remove('active');
            step2.classList.add('completed');
            step3.classList.add('active');
          }
          if (progress >= 95) {
            step3.classList.remove('active');
            step3.classList.add('completed');
          }
        }, 50);
      }

      function updateUI() {
        const hasVideo = !!videoContext;
        questionField.disabled = isLoading || isAsking || !hasVideo;
        askBtn.disabled = isLoading || isAsking || !hasVideo;
        
        if (isLoading) {
          setStatus('loading transcript...', true);
          startProgress();
        } else if (isAsking) {
          setStatus('processing...', true);
          startProgress();
        } else if (hasVideo) {
          setStatus('ready', true);
          progressContainer.style.display = 'none';
        } else {
          setStatus('ready', false);
          progressContainer.style.display = 'none';
        }
      }

      function addMessage(text, isUser = false) {
        const div = document.createElement('div');
        div.className = `message ${isUser ? 'user' : 'assistant'}`;
        
        const bubble = document.createElement('div');
        bubble.className = 'bubble';
        bubble.innerText = text;
        
        const time = document.createElement('div');
        time.className = 'time';
        const now = new Date();
        time.innerText = `${now.getHours().toString().padStart(2,'0')}:${now.getMinutes().toString().padStart(2,'0')}`;
        
        div.appendChild(bubble);
        div.appendChild(time);
        messages.appendChild(div);
        scrollToEnd();
      }

      // Load Transcript
      async function loadTranscript() {
        let url = urlField.value.trim();
        if (!url) {
          addMessage('‚ùå paste a link first');
          return;
        }

        if (url.includes('youtu.be')) {
          const videoId = url.split('/').pop().split('?')[0];
          url = `https://youtube.com/watch?v=${videoId}`;
        }

        isLoading = true;
        updateUI();
        addMessage(`üì° loading: ${url.substring(0, 45)}...`, true);

        try {
          const jinaUrl = `https://r.jina.ai/${encodeURIComponent(url)}`;
          const response = await fetch(jinaUrl);
          
          if (!response.ok) throw new Error(`HTTP ${response.status}`);
          
          const text = await response.text();
          if (text.length < 100) throw new Error('transcript not found');
          
          videoContext = text;
          addMessage(`‚úÖ video loaded ¬∑ ask anything`);
          
        } catch (error) {
          videoContext = '';
          addMessage(`‚ùå error: ${error.message}`);
        } finally {
          isLoading = false;
          updateUI();
        }
      }

      // Ask Question
      async function askQuestion() {
        const question = questionField.value.trim();
        if (!question || !videoContext) return;

        addMessage(question, true);
        questionField.value = '';
        isAsking = true;
        updateUI();

        try {
          const response = await fetch('https://openrouter.ai/api/v1/chat/completions', {
            method: 'POST',
            headers: {
              'Authorization': `Bearer ${API_KEY}`,
              'Content-Type': 'application/json',
              'HTTP-Referer': window.location.origin,
            },
            body: JSON.stringify({
              model: MODEL,
              messages: [
                {
                  role: 'system',
                  content: 'You are a helpful learning assistant. Provide clear, detailed explanations based on the video transcript.'
                },
                {
                  role: 'user',
                  content: `Video transcript: """${videoContext}"""\n\nQuestion: ${question}`
                }
              ],
              temperature: 0.7,
              max_tokens: 2000
            })
          });

          if (!response.ok) {
            const errorData = await response.json().catch(() => ({}));
            throw new Error(errorData.error?.message || `HTTP ${response.status}`);
          }

          const data = await response.json();
          const reply = data.choices[0]?.message?.content || 'no response';
          addMessage(reply);

        } catch (error) {
          addMessage(`‚ùå error: ${error.message}`);
          console.error(error);
        } finally {
          isAsking = false;
          updateUI();
        }
      }

      // Event Listeners
      loadBtn.addEventListener('click', loadTranscript);
      
      askBtn.addEventListener('click', () => {
        if (!isLoading && !isAsking && videoContext) askQuestion();
      });

      questionField.addEventListener('keypress', (e) => {
        if (e.key === 'Enter' && !e.shiftKey) {
          e.preventDefault();
          if (!isLoading && !isAsking && videoContext) askQuestion();
        }
      });

      urlField.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
          e.preventDefault();
          loadTranscript();
        }
      });

      // Initialize
      updateUI();
    })();
  </script>
</body>
</html>